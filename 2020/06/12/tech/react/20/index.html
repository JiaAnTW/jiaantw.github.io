<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1.0, user-scalable=no">

    
      <link rel="icon" href="/favicon.png" />
    

    <title>
        
          tech/react/20 - Bunny&#39;s Tech
        
    </title>

    <!-- Spectre.css framework -->
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-exp.min.css">
    <link rel="stylesheet" href="https://unpkg.com/spectre.css/dist/spectre-icons.min.css">

    <!-- theme css & js -->
    
<link rel="stylesheet" href="/css/book.css">

    
<script src="/js/book.js"></script>


    <!-- tocbot -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/tocbot/4.4.2/tocbot.css">
    
    <!-- katex -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.10.0/katex.min.css">

    
<!-- Google Analytics -->
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-129888855-4', 'auto');
ga('send', 'pageview');
</script>
<!-- End Google Analytics -->

    
<script src="https://cdnjs.cloudflare.com/ajax/libs/zooming/2.1.1/zooming.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function () {
    const zooming = new Zooming()
    zooming.listen('.book-content img')
})
</script>

<meta name="generator" content="Hexo 4.2.1"></head>

<body>

<div class="book-container">
  <div class="book-sidebar">
    <div class="book-brand">
  <a href="/">
    <img src="/favicon.png">
    <span>BUNNY&#39;S TECH</span>
  </a>
</div>
    <div class="book-menu">
  <ul>
<li><a href="/">首頁</a></li>
<li><a href="/">關於我</a></li>
</ul>
<h1 id="WEB開發">WEB開發</h1>
<h2 id="React-js">React.js</h2>
<ul>
<li><a href="/2020/06/12/tech/react/01">環境設定</a></li>
<li><a href="/2020/06/12/tech/react/02">使用create-react-app</a></li>
<li><a href="/2020/06/12/tech/react/03">DOM和ES6</a></li>
<li><a href="/2020/06/12/tech/react/04">HelloWorld!</a></li>
<li><a href="/2020/06/12/tech/react/05">JSX (上)</a></li>
<li><a href="/2020/06/12/tech/react/06">JSX (下)</a></li>
<li><a href="/2020/06/12/tech/react/07">function component</a></li>
<li><a href="/2020/06/12/tech/react/08">props:綁定資料</a></li>
<li><a href="/2020/06/12/tech/react/09">props:綁定函式</a></li>
<li><a href="/2020/06/12/tech/react/10">props: children</a></li>
<li><a href="/2020/06/12/tech/react/11">class component</a></li>
<li><a href="/2020/06/12/tech/react/12">state與詳解setState語法</a></li>
<li><a href="/2020/06/12/tech/react/13">useState</a></li>
<li><a href="/2020/06/12/tech/react/14">React-Developer-Tools</a></li>
<li><a href="/2020/06/12/tech/react/15">Http request:Fetch Api</a></li>
<li><a href="/2020/06/12/tech/react/16">生命週期(1/4):Mount(上)</a></li>
<li><a href="/2020/06/12/tech/react/17">生命週期(2/4):Mount(下)</a></li>
<li><a href="/2020/06/12/tech/react/18">生命週期(3/4):Unmount</a></li>
<li><a href="/2020/06/12/tech/react/19">生命週期(4/4):Update</a></li>
<li><a href="/2020/06/12/tech/react/20">useEffect</a></li>
<li><a href="/2020/06/12/tech/react/21_1">各階層Component的溝通</a></li>
<li><a href="/2020/06/12/tech/react/21_2">useContext和useReducer</a></li>
<li><a href="/2020/06/12/tech/react/22">元件練習(上)</a></li>
<li><a href="/2020/06/12/tech/react/23">元件練習(下)</a></li>
<li><a href="/2020/06/12/tech/react/24">Custom hook</a></li>
<li><a href="/2020/06/12/tech/react/25">Custom hook練習</a></li>
<li><a href="/2020/06/12/tech/react/26">輸入元素與控制組件</a></li>
<li><a href="/2020/06/12/tech/react/27">react-router-dom (上)</a></li>
<li><a href="/2020/06/12/tech/react/28">react-router-dom (下)</a></li>
<li><a href="/2020/06/12/tech/react/29">圖片、css檔、問題集</a></li>
<li><a href="/2020/06/12/tech/react/30">學了React之後</a></li>
</ul>
<h1 id="產品開發">產品開發</h1>
<h2 id="有關前端技術的那些UX事">有關前端技術的那些UX事</h2>
<ul>
<li><a href="/2020/06/12/product/UX/maskMap">口罩地圖(GIS)</a></li>
</ul>

</div>


<script src="/js/book-menu.js"></script>

  </div>

  <div class="sidebar-toggle" onclick="sidebar_toggle()" onmouseover="add_inner()" onmouseleave="remove_inner()">
  <div class="sidebar-toggle-inner"></div>
</div>

<script>
function add_inner() {
  let inner = document.querySelector('.sidebar-toggle-inner')
  inner.classList.add('show')  
}

function remove_inner() {
  let inner = document.querySelector('.sidebar-toggle-inner')
  inner.classList.remove('show')
}

function sidebar_toggle() {
    let sidebar_toggle = document.querySelector('.sidebar-toggle')
    let sidebar = document.querySelector('.book-sidebar')
    let content = document.querySelector('.off-canvas-content')
    if (sidebar_toggle.classList.contains('extend')) { // show
        sidebar_toggle.classList.remove('extend')
        sidebar.classList.remove('hide')
        content.classList.remove('extend')
    }
    else { // hide
        sidebar_toggle.classList.add('extend')
        sidebar.classList.add('hide')
        content.classList.add('extend')
    }
}
</script>

  <div class="off-canvas-content">
    <div class="columns">
      <div class="column col-10 col-lg-12">
        <div class="book-navbar">
          <!-- For Responsive Layout -->

<header class="navbar">
  <section class="navbar-section">
    <a onclick="open_sidebar()">
      <i class="icon icon-menu"></i>
    </a>
  </section>
</header>

        </div>
        <div class="book-content">
          <div class="book-post">
  <h1 id="【React-js入門-20】useEffect-在function-component用生命週期">【React.js入門 - 20】useEffect -  在function component用生命週期</h1>
<h6 id="tags-第11屆鐵人賽">tags: <code>第11屆鐵人賽</code></h6>
<blockquote>
<p>花了那麼多時間講生命週期，那麼function component的生命週期也是直接宣告componentDidMount那些嗎?</p>
</blockquote>
<p>呃，不是。跟<code>state</code>一樣，在function component中我們必須要使用React hook才能設定生命週期函數。</p>
<p>在前面講生命週期時，我們提到最常被使用到的是<code>componentDidMount</code>、<code> componentWillUnmount</code>和<code>componentDidUpdate</code>這三個函數，而React hook把這三者整合起來，變成了<code>useEffect</code>。</p>
<h2 id="React-hook兩大守則">React hook兩大守則</h2>
<ol>
<li>只能在最外層scope宣告</li>
<li>只能在function component或custom hook中使用</li>
</ol>
<p>之前沒有特別講，在這裡提一下，後面會講custom hook是什麼。</p>
<h2 id="useEffect基本語法">useEffect基本語法:</h2>
<p><code>useEffect</code>接收兩個參數，第一個是一個函式，定義componentDidMount或componentDidUpdate要做什麼事，此函式的回傳值也要是一個函式，表示componentWillUnmount 要做什麼事。第二個是一個array，裡面是定義當哪些變數被改變時，這個useEffect要重新被觸發。有點像是過去我們在寫<code>prevState!=this.state</code>這種感覺。</p>
<p>這樣講有點抽象，我們來看語法:</p>
<h3 id="替代componentDidMount">替代componentDidMount</h3>
<p>第二個參數為空array時(不是省略歐)，代表除了第一次以外，接下來每次re-render時，<strong>沒有任何東西的改變可以重新觸發useEffect</strong>，所以就等同於componentDidMount。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/* 下面是 componentDidMount */</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 上面是 componentDidMount */</span></span><br><span class="line">    </span><br><span class="line">&#125;, []); </span><br><span class="line"></span><br><span class="line"><span class="comment">/* 第二個參數是用來限定當哪些變數被改變時useEffect要觸發 */</span></span><br></pre></td></tr></table></figure>
<h3 id="替代componentWillUnmount">替代componentWillUnmount</h3>
<p>componentWillUnmount就是useEffect第一個用來當參數的函式的return值。以下是componentDidMount和componentWillUnmount的集合體。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/* 下面是 componentDidMount*/</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 上面是 componentDidMount */</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">/* 下面是 componentWillUnmount */</span></span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">      <span class="comment">/* 上面是 componentWillUnmount */</span></span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">&#125;, []); </span><br><span class="line"><span class="comment">/* 第二個參數是用來限定當哪些變數被改變時useEffect要觸發 */</span></span><br></pre></td></tr></table></figure>
<h3 id="替代componentDidUpdate…-咦">替代componentDidUpdate… ? 咦 ?</h3>
<p>我一開始在看useEffect的時候，以為第二個參數array不為空、不省略就是componentDidUpdate:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">&#125;, [dependencies參數]); <span class="comment">/* 第二個參數是用來限定當哪些變數被改變時useEffect要觸發 */</span></span><br></pre></td></tr></table></figure>
<p>但實際上我觀察到第一次render還是會執行。查了一下官方文件，精確的說法似乎是<strong>第二個參數是用來限制哪些參數在re-render時(也就是不包含第一次)如果被改變，可以重新觸發useEffect</strong>。</p>
<p>如果想要實現componentDidUpdate，應該要搭配另外一個React hook: <code>useRef</code>。這裡先不解釋它，可以當作是產生一個「被改變後不會觸發re-render」變數的hook(其實我也還沒有特別去研究它XD)。也就是我們用useRef去產生一個紀錄是否完成第一次渲染的變數，初始值給false，第一次執行effect後改為true。</p>
<p>也就是<strong>嚴格實現componentDidUpdate的語法</strong>為:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mounted=useRef();</span><br><span class="line">useEffect(<span class="function"><span class="params">()</span>=&gt;</span>&#123; <span class="comment">//componentDidUpdate</span></span><br><span class="line">  <span class="keyword">if</span>(mounted.current===<span class="literal">false</span>)&#123;</span><br><span class="line">    mounted.current=<span class="literal">true</span>;</span><br><span class="line">    <span class="comment">/* 下面是 componentDidMount*/</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 上面是 componentDidMount */</span>      </span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">/* 下面是componentDidUpdate */</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 上面是componentDidUpdate */</span></span><br><span class="line"></span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="function">(<span class="params">(</span>)=&gt;</span>&#123;</span><br><span class="line">       <span class="comment">/* 下面是 componentWillUnmount */</span></span><br><span class="line">  </span><br><span class="line">  </span><br><span class="line">      <span class="comment">/* 上面是 componentWillUnmount */</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;,[dependencies參數]); <span class="comment">/* 第二個參數是用來限定當哪些變數被改變時useEffect要觸發 */</span></span><br></pre></td></tr></table></figure>
<p>記得要引入useRef()。</p>
<h3 id="替代componentDidMount-componentDidUpdate">替代componentDidMount + componentDidUpdate</h3>
<p>當你「省略第二個用來監控的參數array」或是「該array不為空」時，它就等同於componentDidMount + componentDidUpdate的集合體。省略的話就是代表每次re-render時都會觸發useEffect，不省略不為空則代表當re-render時，如果你放在array中的值有被改變，就會觸發useEffect。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/* 下面是 componentDidMount 和  componentDidUpdate */</span></span><br><span class="line">    </span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 上面是 componentDidMount 和  componentDidUpdate */</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">/* 下面是 componentWillUnmount */</span></span><br><span class="line">      </span><br><span class="line">      </span><br><span class="line">      <span class="comment">/* 上面是 componentWillUnmount */</span></span><br><span class="line">    &#125;;</span><br><span class="line">    </span><br><span class="line">&#125;, [dependencies參數]); <span class="comment">/* 第二個參數是用來限定當哪些變數被改變時useEffect要觸發 */</span></span><br></pre></td></tr></table></figure>
<h3 id="其他">其他</h3>
<p><strong>可以有多個useEffect存在同一function component中</strong>，所以我們可以針對不同的變數去寫不同的<code>useEffect</code>。</p>
<h2 id="練習">練習</h2>
<h3 id="step-0-把之前的Baby-js改成function-component吧">step 0 : 把之前的Baby.js改成function component吧!</h3>
<p>我們把之前的嬰兒整合一下，不過因為它太胖了，我們先把它變成function component，也就是把所有的<code>state</code>改成<code>useState</code>形式，class 的 member  function改成function中的function。讓巨嬰變回中嬰(?)之後，再來慢慢把生命週期補上去。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">const</span> Baby=<span class="function">(<span class="params">props</span>)=&gt;</span>&#123;</span><br><span class="line">    <span class="comment">/* 把state變成useState */</span></span><br><span class="line">    <span class="keyword">const</span> [isGetData,setGetData]=useState(<span class="literal">false</span>);</span><br><span class="line">    <span class="keyword">const</span> [Mom,setMom]=useState(<span class="string">""</span>);</span><br><span class="line">    <span class="keyword">const</span> [isRightDad,setRightDad]=useState(<span class="literal">false</span>);</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 把class 的 member function改成function中的function */</span></span><br><span class="line">    <span class="keyword">const</span> ajaxSimulator=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">            setGetData(<span class="literal">true</span>);</span><br><span class="line">            setMom(<span class="string">"小美"</span>);</span><br><span class="line">        &#125;,<span class="number">3000</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> checkDad=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(props.dad===<span class="string">"Chang"</span>)</span><br><span class="line">            setRightDad(<span class="literal">true</span>)</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            setRightDad(<span class="literal">false</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(isRightDad===<span class="literal">false</span>)</span><br><span class="line">        <span class="keyword">return</span>(</span><br><span class="line">            &lt;div&gt;他的媽媽，是誰，干你X事&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        );</span></span><br><span class="line"><span class="regexp">    else if(isGetData===false)</span></span><br><span class="line"><span class="regexp">        return(</span></span><br><span class="line"><span class="regexp">            &lt;div id="msg"&gt;讀取中&lt;/</span>div&gt;</span><br><span class="line">        );</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span>(</span><br><span class="line">            &lt;div id=<span class="string">"msg"</span>&gt;他的媽媽是&#123;Mom&#125;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">    );  </span></span><br><span class="line"><span class="regexp">&#125;</span></span><br><span class="line"><span class="regexp">export default Baby;</span></span><br></pre></td></tr></table></figure>
<p>App.js也順便換成function component，然後加入一個可以換爸爸的功能:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br><span class="line"><span class="keyword">import</span> Baby <span class="keyword">from</span> <span class="string">'./Baby'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> App=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    <span class="keyword">const</span> [dad, setDad] = useState(<span class="string">"Chang"</span>);</span><br><span class="line">    <span class="keyword">const</span> [born, setBorn] = useState(<span class="literal">true</span>);</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> changeDad=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(dad===<span class="string">"Chang"</span>)&#123;</span><br><span class="line">        setDad(<span class="string">"Wang"</span>)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">else</span>&#123;</span><br><span class="line">        setDad(<span class="string">"Chang"</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> spawnBaby=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">      <span class="keyword">if</span>(born===<span class="literal">true</span>)&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">Baby</span> <span class="attr">dad</span>=<span class="string">&#123;dad&#125;/</span>&gt;</span></span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span>(</span><br><span class="line">      &lt;div&gt;</span><br><span class="line">        &#123;spawnBaby()&#125;</span><br><span class="line">        &lt;div id=<span class="string">"talk"</span>&gt;&lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">        &lt;button onClick=&#123;changeDad&#125;&gt;換爸爸!&lt;/</span>button&gt;</span><br><span class="line">        &lt;button onClick=&#123;()=&gt;&#123;setBorn(!born)&#125;&#125;&gt;&#123;(born===<span class="literal">true</span>)?<span class="string">"讓他回去肚子裡"</span>:<span class="string">"讓他生"</span>&#125;&lt;<span class="regexp">/button&gt;</span></span><br><span class="line"><span class="regexp">      &lt;/</span>div&gt;</span><br><span class="line">    );</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> App;</span><br></pre></td></tr></table></figure>
<h3 id="step-1-引入useEffect">step 1 : 引入useEffect</h3>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> React, &#123; useState, useEffect &#125; <span class="keyword">from</span> <span class="string">'react'</span>;</span><br></pre></td></tr></table></figure>
<h3 id="step-2-替代Baby-js中的componentDidMount的ajax部份">step 2 : 替代Baby.js中的componentDidMount的ajax部份</h3>
<p>當<strong>第二個參數為空array時，這個useEffect就相當於是<code>componentDidMount</code></strong>。<br>
所以，我們現在讓Baby.js在被創造時，執行花3秒取得媽媽資訊的<code>ajaxSimulator</code>:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">const</span> checkDad=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    (省略)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/* 下面是 componentDidMount */</span></span><br><span class="line">    </span><br><span class="line">    ajaxSimulator();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* 上面是 componentDidMount */</span>  </span><br><span class="line">&#125;, []);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(isRightDad===<span class="literal">false</span>)&#123;</span><br><span class="line">    (省略)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="step-3-替代Baby-js中的componentDidMount-componentDidUpdate">step 3 :  替代Baby.js中的componentDidMount+componentDidUpdate</h3>
<p>現在加入一個新的函式來代替<code>componentDidUpdate</code>。在這邊，我們讓Baby.js的props中的爸爸第一次被渲染以及dad被改變時，用<code>checkDad</code>去檢查爸爸正確性，以決定是否提供寶寶的媽媽資訊:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> checkDad=<span class="function"><span class="params">()</span>=&gt;</span>&#123;</span><br><span class="line">    (省略)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    ajaxSimulator();    </span><br><span class="line">&#125;, []);</span><br><span class="line"></span><br><span class="line">useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">/* 下面是 componentDidMount和componentDidUpdate */</span></span><br><span class="line">    </span><br><span class="line">    checkDad();</span><br><span class="line">    </span><br><span class="line">    <span class="comment">/* 上面是 componentDidMount和componentDidUpdate */</span>    </span><br><span class="line">&#125;, [props.dad]); <span class="comment">/* 加入監控的props.dad */</span> </span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(isRightDad===<span class="literal">false</span>)&#123;</span><br><span class="line">    (省略)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="step-4-替代Baby-js中的用來去除喊聲爸componentWillMount">step 4 : 替代Baby.js中的用來去除喊聲爸componentWillMount</h3>
<p>現在先在剛剛專為ajax的<code>useEffect</code>加入喊聲爸的函式，讓我們等等可以用<code>componentWillMount</code>移除。</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    ajaxSimulator();</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"talk"</span>).append(<span class="string">'爸!'</span>)</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure>
<p>這樣按很多次之後就會呈現跟之前很像的一堆「爸!」狀況:<br>
<img src="https://i.imgur.com/donpIjs.png" alt=""></p>
<p>接下來我們加入<code>componentWillMount</code>來在元件死去時移除「爸!」。在<code>useEffect</code>中，<strong>第一個參數函式的return就是<code>componentWillMount</code></strong>，也就是第一個參數函式的return值也要是一個函式:</p>
<figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    ajaxSimulator();</span><br><span class="line">    <span class="built_in">document</span>.getElementById(<span class="string">"talk"</span>).append(<span class="string">'爸!'</span>)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span><span class="function">(<span class="params">(</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="comment">/* 下面是 componentWillUnmount */</span></span><br><span class="line"></span><br><span class="line">        <span class="built_in">document</span>.getElementById(<span class="string">"talk"</span>).innerHTML=<span class="string">""</span>;</span><br><span class="line">        </span><br><span class="line">        <span class="comment">/* 上面是 componentWillUnmount */</span></span><br><span class="line">    &#125;)</span><br><span class="line">&#125;, []);</span><br></pre></td></tr></table></figure>
<h2 id="小結">小結:</h2>
<p><code>useState</code>和<code>useEffect</code>是目前最常被使用的React hook。本系列關於React hook api只會介紹這兩個和之後會講的custom hook，其他還有<code>useRef</code>、<code>useContext</code>、<code>useReducer</code>等，有興趣可以參考<a href="https://zh-hant.reactjs.org/docs/hooks-reference.html" target="_blank" rel="noopener">官方文件</a>，或是其他目前幾篇以React hook為主體的系列。</p>
<p>接下來兩篇會分別以class component和function component練習所有目前所述的React特性。</p>

</div>


  <div class="book-comments">
    




  </div>



<script src="/js/book-post.js"></script>

        </div>
      </div>
      <div class="column col-2 hide-lg">
        <div class="book-post-info">
  
    <div class="book-post-meta">

  <div class="author">

    <!-- Author image -->
    <div class="author-img">
      
        <figure class="avatar avatar-lg">
          <img src="/images/profile.jpg" alt="...">
        </figure>
      
    </div>

    <!-- Author title -->
    <div class="author-title">
      <div>Andy Chang</div>
      <div>2020-06-12</div>
    </div>
  </div>

  

  <div class="divider"></div>
</div>
  

  <div class="book-tocbot">
</div>
<div class="book-tocbot-menu">
  <a class="book-toc-expand" onclick="expand_toc()">Expand all</a>
  <a onclick="go_top()">Back to top</a>
  <a onclick="go_bottom()">Go to bottom</a>
</div>


<script src="/js/book-toc.js"></script>

</div>
      </div>
    </div>
  </div>
  
  <a class="off-canvas-overlay" onclick="hide_canvas()"></a>
</div>

</body>
</html>


<script src="/js/book.js"></script>
